execute as @e[type=minecraft:item,nbt=!{Item:{id:"minecraft:experience_bottle"}}] at @s if entity @e[type=minecraft:item,distance=..1,limit=1,nbt={Item:{id:"minecraft:experience_bottle"}}] unless entity @e[type=minecraft:item,limit=1,distance=..1,tag=ready_to_transfer] run tag @s add ready_to_transfer
execute as @e[type=minecraft:item,nbt=!{Item:{id:"minecraft:experience_bottle"}},tag=ready_to_transfer] at @s if entity @e[type=minecraft:item,distance=..1,limit=1,nbt={Item:{id:"minecraft:experience_bottle"}}] if entity @e[type=minecraft:item,distance=..1,limit=1,nbt=!{Item:{id:"minecraft:experience_bottle"}},tag=!ready_to_transfer] run data modify entity @e[type=minecraft:item,distance=..1,limit=1,sort=nearest,nbt=!{Item:{id:"minecraft:experience_bottle"}},tag=!ready_to_transfer] Item.tag.Enchantments append from entity @s Item.tag.StoredEnchantments[0]
execute as @e[type=minecraft:item,nbt=!{Item:{id:"minecraft:experience_bottle"}},tag=ready_to_transfer] at @s if entity @e[type=minecraft:item,distance=..1,limit=1,nbt={Item:{id:"minecraft:experience_bottle"}}] if entity @e[type=minecraft:item,distance=..1,limit=1,nbt=!{Item:{id:"minecraft:experience_bottle"}},tag=!ready_to_transfer] run data modify entity @e[type=minecraft:item,distance=..1,limit=1,sort=nearest,nbt=!{Item:{id:"minecraft:experience_bottle"}},tag=!ready_to_transfer] Item.tag.Enchantments append from entity @s Item.tag.Enchantments[0]

execute as @e[type=minecraft:item,nbt=!{Item:{id:"minecraft:experience_bottle"}},tag=ready_to_transfer] at @s if entity @e[type=minecraft:item,distance=..1,limit=1,nbt={Item:{id:"minecraft:experience_bottle"}}] if entity @e[type=minecraft:item,distance=..1,limit=1,nbt=!{Item:{id:"minecraft:experience_bottle"}},tag=!ready_to_transfer] run execute as @e[type=minecraft:item,distance=..1,limit=1,nbt={Item:{id:"minecraft:experience_bottle"}}] store result score @s itemCount run data get entity @s Item.Count
execute as @e[type=minecraft:item,nbt=!{Item:{id:"minecraft:experience_bottle"}},tag=ready_to_transfer] at @s if entity @e[type=minecraft:item,distance=..1,limit=1,nbt={Item:{id:"minecraft:experience_bottle"}}] if entity @e[type=minecraft:item,distance=..1,limit=1,nbt=!{Item:{id:"minecraft:experience_bottle"}},tag=!ready_to_transfer] run execute as @e[type=minecraft:item,distance=..1,limit=1,nbt={Item:{id:"minecraft:experience_bottle"}}] run scoreboard players remove @s itemCount 1
execute as @e[type=minecraft:item,nbt=!{Item:{id:"minecraft:experience_bottle"}},tag=ready_to_transfer] at @s if entity @e[type=minecraft:item,distance=..1,limit=1,nbt={Item:{id:"minecraft:experience_bottle"}}] if entity @e[type=minecraft:item,distance=..1,limit=1,nbt=!{Item:{id:"minecraft:experience_bottle"}},tag=!ready_to_transfer] run execute as @e[type=minecraft:item,distance=..1,limit=1,nbt={Item:{id:"minecraft:experience_bottle"}}] store result entity @s Item.Count byte 1 run scoreboard players get @s itemCount

# execute as @e[tag=ready_to_transfer] run tag @s remove ready_to_transfer
